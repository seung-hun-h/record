- 예측 가능한 API는 사용성을 높여준다

## 일관성 유지하기
- 일관된 디자인에는 변형이나 모순이 없다. 일관된 디자인은 사용자의 이전 경험을 활용하여 직관적인 인터페이스를 만드는데 도움을 준다
- 모든 API가 지닌 규정된 표준을 사용하거나 다른 사람들이 만들어 둔 형태를 그대로 모방하는 훈련을하면 데이터와 목표의 일관성을 만들어낼 수 있다
- **일관성을 대가로 사용성을 지불해서는 안된다**

### 일관된 데이터 디자인하기
- 일관적인 이름 짓기
	- 계좌 번호를 나타내는 이름인 `accountNumber`, `number`, `source` 를 맥락에 따라 다르게 사용하지 말자
	- 같은 컨셉을 여러 가지 다른 이름으로 표현해야 하는 경우, 유사한 것을 선택해야 한다
- 일관적인 데이터 포맷 적용하기 
	- 특정 데이터 타입에 대한 포맷이 정해졌다면 같은 데이터 타입은 모두 같은 포맷을 적용하는 것이 좋다
- 일관적인 데이터구조 유지하기
	- `/accounts/{accountNumber}`, `/transfer/{transferId}` 처럼 단수와 복수를 혼용하지 말자
	- 둘 중 하나를 정하고 엄격하게 지켜야한다

### 일관적인 목표 디자인하기
- API 동작은 목표에 따라 결정된다
	- API의 목표들은 입력을 기다리다가 성공 또는 오류 피드백을 반환한다
- API의 목표 일관성 유지하기
	- `계좌 읽기`, `사용자 정보 가져오기` 는 서로 다른 동사를 사용해 일관적이지 않다
	- `계좌 읽기`, `사용자 정보 읽기` 처럼 일관적인 동사를 사용하는 편이 좋다
- 데이터 일관성 유지하기
	- 쿼리 파라미터를 `fromDate=1423267200`, `untilDay=2015-03-17`로 사용하는 것은 일관적이지 않다
	- `fromDate=2015-02-07`, `toDate=2015-03-17`로 표현하는 것이 좋다
- 응답 일관성 유지하기
	- 모든 목표가 201, 202 같은 코드를 반환하지 않고 200을 반환했다면 새로운 API도 200을 반환하는 편이 나을 수 있다
	- 오류를 나타내기 위해서 일관적인 HTTP 상태 코드를 반환해야 한다. 응답 메시지에 `MISSING_MANDATORY_PROPERTY` 같은 일반 코드를 정의 했다면, API 요청에 필수 값이 누락된 경우 반드시 해당 코드도 함께 반환해야 한다
 - 일관성은 API 형태뿐 아니라 작동 방식에도 영향을 미친다(?)
	 - 이전에 설계된 모든 민감한 행동이 통제 및 실행 목표로 구성되어 있다면, 첫 번째 행동은 액션을 실행하지 않고 모든 검증을 수행하고, 두 번째 행동은 실제 행동을  실행하는 목표로 표현되어야 한다

### 일관성의 4단계
1. API 내부의 일관성
   - API 설계에 관한 의사결정마다 일관성을 잃지 않도록 주의해야 한다
2. 팀 API / 회사 / 조직 간의 일관성(조직에서 제공하는 API 전체의 일관성)
   - API의 사용자들은 조직내 API 디자이너가 몇명인지 관심없다. API의 일부분을 익힌 후 다른 부분들도 쉽게 이해하고 사용할 수 있는지에 관심을 둔다
3. 도메인 내의 API 일관성
   - 특정 도메인에서 작업할 때는 반드시 따라야하는 표준이나 관행이 존재한다
   - 해군 네비게이션 시스템에서는 킬로미터 보다는 해리를 사용한다
4. 외부 세계와의 일관성
   - 표준을 준수하면 이전에 API를 사용해 본 적이 없는 사람들마저도 API를 예측할 수 있고, 외부 세계의 API와의 상호 운용성을 향상시킨다

### 타인을 따라하자: 일반적인 관행과 표준을 준수하기
- API가 표준(혹은 사실상 표준)따르면 이해하기 쉬워진다
- ISO, RFC와 같은 조직에서 표준을 제안하고 있다

### 일관성 현명하게 적용하기
- 일관성을 유지하는 것도 어렵고, 맹목적으로 일관성을 적용하는 것도 피해야 한다
- `API 스타일 가이드` 와 같은 지침을 만들어두는 것은 좋은 생각이다
- 일관성은 중요하지만, 그 대가로 사용성을 저해하거나 상식에 반대되어서는 안된다

## 적응 가능하게 하기

### 다른 포맷으로 제공하거나 응답하기
- 컨슈머의 요청에 대한 응답 포맷은 JSON뿐 아니라 csv, xml등 다양하다
-  `GET /accounts/{accountId}/trasactions?format=CSV` 처럼 쿼리 파라미터에 응답 포맷을 지정할 수 있다
- HTTP는 콘텐츠 네고시에이션을 할 수 있다
	- 클라이언트 요청 헤더에 `Accept: application/json` 을 입력하여 응답의 희망 포맷을 지정할 수 있다
	- 서버 요청 헤더에 `Content-Type: application/json`을 입력하여 응답의 포맷을 지정할 수 있다
	- 클라이언트 요청 헤더에 `Content-Type: application/json`을 입력하여 요청 데이터 포맷을 지정할 수 있다
		- 서버가 해당 포맷을 이해할 수 없으면 `415 Unsupported Media Type` 응답을 준다

### 국제화 현지화
- 국제화는 API가 현지화를 할 수 있도록 하는 메커니즘이다
	- `Accept-Language`를 제공한다
- 현지화는 특정 지역(en-US)에 해당하는 현지화 요청을 다룰 수 있게된다는 의미다
	- 킬로미터 대신 마일을 사용하는 등
- `Accept-Language`, `Content-Language`를 통해 어떤 언어가 있는지, 있어야 하는지 지정할 수 있다
- `Accept-Language` 헤더에 지정된 언어를 서버에서 지원하지 않는다면 `406 Not Acceptable` 응답을 줄 수있다

### 필터, 페이지, 정렬 적용하기
- 페이지
	- 페이지네이션을 위해서 `page`, `pageSize` 파라미터를 추가할 수 있다
		- `page`: 조회 대상 페이지
		- `pageSize`: 페이지당 리소스의 수(페이지의 크기)
		- `GET /accounts/123456/transactions?pageSize=10&page=1`
	- HTTP 헤더를 사용할 수 도 있다
		- `Range: items=0-9`, 다음 페이지를 가져오기 위해서는 `Range: items=10-19`
		- 컬렉션의 단위는 일반적으로 `items`를 사용한다
- 필터
	- `GET /accounts/123456/trasactions?category=restaurant`는 음식점 카테고리에 포함된 거래 내역을 조회한다
- 정렬
	- `GET /accounts/123456/trasactions?sort=-amount,+date`는 거래 금액 내림차순, 최근 정보순으로 정렬하여 조회한다

## 탐색 가능하게 하기
- API도 책처럼 탐색 가능하게 디자인할 수 있다

### 메타데이터 제공하기
- 메타데이터는 데이터를 위한 데이터이다
	- 페이지와 관련된 데이터, 가능한 행위 등을 제공하면 컨슈머는 현재 어디에 있고, 어디까지 요청할 수 있는지, 무엇을 할 수 있는지 좀 더 풍부한 정보를 얻을 수 있다

- 송금 내역
```JSON
{
	"pagination": {
		"page": 1,
		"totalPages": 9
	},
	"items": [
		{
			"id": "00001",
			"date": "2021-01-01",
			"source": "123456",
			"destination": "456789",
			"amount": "1045.2",
			"actions": ["cancel"]
		},
		...
	]
}
```

- `pagenation`을 통해 현재 어디에 있고, 어디까지 이동할 수 있는지 알 수 있다
- `actions`를 통해 가능한 동작을 할 수 있다
	- 예약 송금은 아직 처리되지 않았으니 취소할 수 있다
- 메타데이터는 필수는 아니지만 제공하면 API의 사용성을 크게 향상할 수 있다


### 하이퍼미디어 API 만들기
- 하이퍼미디어 메타 데이터를 사용하면 컨슈머는 별도의 가공 없이 해당 URL에 GET 요청을 보내면된다
- 하이퍼미디어 메타 데이터는 보통 `href`, `_links`, `links` 와 같은 이름으로 표현된다

```JSON
"items": [
	{
		"id": "1234567",
		"href": "/accounts/1234567"
	}
]
```

- 표준은 없고 가장 잘 알려진 포맷 중 하나로 HAL이 있다

```JSON
{
	"_links" : {
		"self": {
			"href": "/accounts/1234567" // 은행 계좌 스스로를 가리킨다
		},
		"trasacntions": {
			"href": "/accounts/1234567/trasactions" // 은행 계좌의 거래 내역
		}
	}
}
```

- 하이퍼미디어 API는 URL만 제공하는 것이 아니라 사용가능한 HTTP 메서드도 제공한다
- Siren은 다음과 같이 작성한다

```JSON
"properties": {
	"id": "00001",
	"date": ...,
},
"links": {
	{
		"rel": ["self"],
		"href": "/transfers/00001"
	}
},
"actions": [
	{
		"name": "cancel",
		"href": "/transfers/00001",
		"method": "DELETE"
	}
]
```

### HTTP 프로토콜의 장점 이용하기
- `OPTIONS`를 사용하면 해당 리소스에서 사용할 수 있는 메서드를 조회할 수 있다
```TEXT
OPTIONS /transfers/00001

200 OK
Allow: GET, DELETE
```

- HTTP 프로토콜의 기능을 사용할 떄는 컨슈머에게 정말 도움이 되는지 판단해야한다
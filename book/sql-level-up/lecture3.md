# 3강 DMBS와 실행계획
---
- RDB를 조작할 떄는 SQL는 전용 언어를 사용한다
- SQL을 사용하면 절차적인 세부 사항을 작성하지 않고 사용한다

## 1. 권햔 이양의 죄악
- C, 자바, 루비와 같은 절차가 기초가 되는 언어는 사용자가 데이터에 접근하기 위한 절차(How)를 책임지고 기술한다
- SQL은 비절차적인 언어로 절차를 시스템에 맡기고 대상(What)을 기술하는 것으로 축소되었다
	- 비즈니스 전체의 생산성 향상을 위함이다
	- 사용 방법이 어렵고 성능 문제가 발생할 수 있다

## 2. 데이터에 접근하는 방법은 어떻게 결정할까?
- RDB에서 데이터 접근 절차를 결정하는 모듈은 쿼리 평가 엔진이라고 부른다
	- SQL 구문을 처음 읽어 들이는 모듈이다
	- 파서, 옵티마이저 같은 여러 서브 모듈로 이루어진다


![image](https://user-images.githubusercontent.com/60502370/191382352-b1c61ff9-2db1-4ce8-8491-b57c2a9ec204.png)

### 파서
- 구문 분석(파스) 역할을 담당한다
	- 사용자로부터 입력 받은 SQL이 항상 올바르다는 보장이 없기 떄문이다

### 옵티마이저
- DBMS 두뇌의 핵심으로 데이터 접근법(실행 계획)에 대한 최적화를 진행한다
- 인덱스 유무, 데이터 분산 또는 편향 정도, DBMS 내부 매개변수 등 다양한 조건을 고려해서 많은 실행 계획을 작성한다
- 실행 계획의 비용을 계산한다
- 가장 낮은 비용을 가진 실행 계획을 선택한다

### 카탈로그 매니저
- 옵티마이저가 실행 계획을 세울때 중요한 정보를 제공한다
- DBMS 내부 정보를 모아놓은 테이블로, 테이블 또는 인덱스의 통계 정보가 저장되어 있다

### 플랜 평가
- 옵티마이저가 SQL 구문에서 여러 개의 실행 계획을 세운 후 그것을 받아 최적의 실행 결과를 선택한다
- 실행 계획은 DBMS가 실행할 수 있는 형태의 코드가 아닌 사람이 읽을 수 있는 문자 그대로의 '계획서'이다
	- 성능이 좋지 않은 SQL 구문이 있을 때 실행 계획을 읽고, 수정 방안 등을 고려할 수 있다

## 3. 옵티마이저와 통계 정보
- 카탈로그 매너지가 관리하는 통계 정보에 대해서는 데이터베이스 엔지니어가 항상 신경 써줘야 한다
- 옵티마이저가 최적의 플랜을 선택하는데 실패하는 패턴이 여러가지 있다. 그 중 통계 정보가 부족한 경우가 대표적인 원인이다

- 카탈로그에 포함되어 있는 통계 정보
	- 각 테이블의 레코드 수
	- 각 테이블의 필드 수와 필드 크기
	- 필드의 카디날리티
	- 필드 값의 히스토그램
	- 필드 내부에 있는 NULL 수
	- 인덱스 정보

- 문제가 생기는 경우는 카탈로그 정보가 테이블 또는 인덱스의 실제와 일치하지 않을 때이다
	- 테이블 데이터가 삽입/갱신/삭제 되었을 때 통계 정보를 업데이트 하지 않으면 옵티마이저는 옛날 정보를 가지고 실행 계획을 만들게 된다

## 4. 최적의 실행 계획이 작성되게 하려면
- 테이블의 데이터가 많이 바뀌면 카탈로그의 통계 정보도 함께 갱신해야 한다
	- 수동 갱신
	- 데이터를 크게 갱신 배치 처리가 있을 때는 Job Net을 조합하는 경우도 있다
	- Oracle은 기본 설정에서 정기적으로 통계 정보 갱신 작업이 수행된다
	- SQL Server는 갱신 처리가 수행되는 시점에 자동으로 통계 정보를 갱신한다

- 통계 정보 갱신은 실행 비용이 굉장히 높은 작업이므로, 갱신 시점을 확실하게 검토해야 한다

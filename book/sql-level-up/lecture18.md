# 18강 기능적 관점으로 구분하는 결합 종류
---
- SQL에서의 결합
	- 크로스 결합
	- 내부 결합
	- 외부 결합
	- 자기 결합
	- 등가 결합/비등가 결합
	- 자연 결합
- 이들 중 기능적으로 분류한 것이 크로스 결합, 내부 결합, 외부 결합이다
	- 결과의 형태에 따라 이름 지어졌다
	- 서로 배타적이다
- 등가/비등가 결합은 결합 조건으로 등호를 사용하는지, 부등호를 사용하는지 차이다
- 자연 결합은 가장 자주 사용하는 '내부 결합이면서 등가 결합'이라는 조합을 간단하게 작성하는 것이다

---
### 컬럼: 자연 결합 구문
- 자연 결합은 다음과 같은 구문으로 작성한다
```SQL
SELECT *
FROM Employees NATURAL JOIN Departments;
```

- 자연 결합은 결합 조건을 따로 기술하지 않고, 암묵적으로 같은 이름의 필드가 등호로 결합된다

**장점**
- 자주 사용하는 등가 결합을 짧게 쓸 수 있다
**단점**
- 실제로 내부 결합을 사용한다고 해서 써야할 양이 많아지는 것은 아니다
- 필드 이름이 다르거나 자료형이 다르면 적용할 수 없어 확장성이 떨어진다
- 테이블 정의를 제대로 이해하고 있지 않다면, 문장을 보았을 때 결합 조건이 무엇인지 알 수 없어 가독성이 떨어진다

- 자연 결합과 내부 결합의 중간적인 형태로 USING이 있다

```SQL
SELECT *
FROM Employees INNER JOIN Departments
USING(dept_id);
```

- USING 구도 표준 SQL에 정의되어 있다
- 하지만 자연 결합과 비슷한 기능적 제한을 가지고 있다

- 특별한 사정이 없다면 그냥 내부 결합을 사용하자
---

## 1. 크로스 결합 - 모든 결합의 모체
- 크로스 결합은 두 테이블의 모든 가능한 조합을 구한다
- 실무에서 거의 사용할 일이 없다
	- 이러한 결과가 사용되는 경우가 거의 없다
	- 비용이 매우 많이 드는 연산이다

### 실수로 사용한 크로스 결합
```SQL
SELECT *
FROM Employees, Departments;
```
- 이 경우, 결합 조건이 없으므로 DBMS는 어쩔 수 없이 두 개의 테이블에서 나올 수 있는 모든 조합을 만들어버린다
- 이러한 실수를 막으려면 표준 SQL에 맞게 결합 구문을 사용하는 것이 좋다

## 2. 내부 결합 - 왜 '내부'라는 말을 사용할까?
- 내부 결합의 결과는 모두 크로스 결합의 결과의 일부다
- 내부는 '데카르트 곱의 부분 집합'이라는 뜻이다

### 내부 결합과 같은 기능을 하는 상관 서브 쿼리
```SQL
SELECT e.emp_id e.emp_name, e.dept_id, d.dept_name
FROM Employees e INNER JOIN Departments d
						ON e.dept_id = d.dept_id
;
```

```SQL
SELECT e.emp_id e.emp_name, e.dept_id,
		(SELECT d.dept_name
		 FROM Departments d
		 WHERE e.dept_id = d.dept_id) AS dept_name)
FROM Employees
;
```

- 아래 쿼리는 상관 서브쿼리 내부에서 결합 조건을 기술하고 있다
	- dept_id는 부서의 기본 키이므로, 이를 조건으로 지정하면 레코드가 한 개로 한정 될 것이 보장된다
	- 따라서 기본 키를 사용하면 상관 서브쿼리를 스칼라 서브쿼리로 사용할 수 있다
- 그러나 내부 결합과 상관 서브쿼리 중 내부 결합을 사용하는 것이 좋다
	- 상관 서브쿼리를 스칼라 서브쿼리로 사용하면 결과 레코드 수만큼 상관 서브쿼리를 실행해 비용이 꽤 높아진다

## 3. 외부 결합 - 왜 '외부'라는 말을 사용할까?
- 내부 결합과 외부 결합은 배타적인 연산이다
- '외부'는 '데카르트 곱의 부분집합이 아니다'라는 의미다
- 하지만 데이터 상태에 따라서 데카르트 곱의 부분집합이 되기도 한다

### 외부 결합의 작동
- 외부 결합의 종류
	- 왼쪽 외부 결합
	- 오른쪽 외부 결합
	- 완전 외부 결합
- 마스터가 되는 테이블을 왼쪽에 적으면 왼쪽 외부 결합, 오른쪽에 적으면 오른쪽 외부 결합이다
- 마스터 테이블에만 존재하는 키가 있을 떄는 해당 키를 제거하지 않고 결과에 보존한다

```SQL
SELECT e.emp_id e.emp_name, e.dept_id, d.dept_name
FROM Employees e INNER LEFT OUTER JOIN Departments d
						ON e.dept_id = d.dept_id
;

---

SELECT e.emp_id e.emp_name, e.dept_id, d.dept_name
FROM Employees e INNER RIGHT OUTER JOIN Departments d
						ON e.dept_id = d.dept_id
;
```

## 4. 외부 결합과 내부 결합의 차이
- 외부 결합 결과가 크로스 결합 결과의 부분 집합이 아닌 이유는, 외부 결합이 마스터 테이블의 정보를 모두 보존하고자 NULL을 생성하기 때문이다
	- 크로스 결합과 내부 결합은 NULL을 생성하지 않는다

## 5. 자기 결합 - '자기'란 누구일까?
- 자기 자신과 결합하는 연산이다
- 자기 결합은 생성되는 결과를 기준으로 분류하는 것이 아니라 연산의 대상으로 무엇을 사용하는지에 따른 분류이다
	- 자기 결합 + 크로스 결합, 자기 결합 + 외부 결합과 같은 조합이 가능하다
- 자기 결합은 테이블에 별칭을 두어 마치 다른 테이블인 것처럼 다룬다

```SQL
SELECT d1.digit + (d2.digit * 10) AS seq
FROM Digits d1 CROSS JOIN Digits d2;
```
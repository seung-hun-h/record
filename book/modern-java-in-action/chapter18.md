# 함수형 관점으로 생각하기
- 함수형은 람다, 일급 함수와 관련이 있으며 때로는 객체 변화를 제한하는 것과 관련있다

## 시스템 구현과 유지보수
- 시스템 구현에 동시성 처리가 요구된다면 매우 어렵다
- 자바 8의 스트림을 사용하면 잠금 문제를 신경쓰지 않아도 된다
  - 단 상태가 없는 동작이어야 한다
- 유지 보수를 쉽게하려면 시스템 구조를 이해할 수 있어야 한다
  - 클래스 계층으로 시스템 구조를 보기 쉽게 나타낼 수 있다
- 시스템의 각 부분의 상호 의존성을 가리키는 결합성과 시스템의 다양한 부분이 서로 어떤 관계를 갖는지 가리키는 응집성이라는 소프트웨어 엔지니어링 도구로 프로그램 구조를 평가할 수 있다.
- 실질적으로 많은 프로그래머는 예상치 못한 변수값 때문에 코드 크래시가 발생할 수 있다
  - 함수형 프로그래밍의 부작용 없음(no side effect)와 불변성(immutability) 개념이 이 문제를 해결하는데 도움을 준다

### 공유된 가변 데이터
- 변수가 예상하지 못한 값을 갖는 이유는 우리가 유지보수하는 시스템의 여러 메서드에서 공유된 가변 데이터 구조를 읽고 갱신하기 때문이다.
  - 공유 가변 데이터 구조를 사용하면 프로그램 전체에서 데이터 갱신 사실을 추적하기 어려워진다
- 어떤 자료구조도 바꾸지 않는 시스템은 유지보수 하기 쉬울 것이다
  - 클래스의 상태를 변경하지 않고 return 문을 통해서만 자신의 결과를 반환하는 메서드를 순수(pure) 메서드 혹은 부작용 없는(no side effect) 메서드라 한다
- 부작용이란 함수 내에 포함되지 못한 기능을 말한다
  - 자료구조를 고치거나 필드에 값을 할당
  - 예외 발생
  - 파일에 쓰기 등의 I/O 동작 수행
- 불변 객체를 이용해서 부작용을 없애는 방법도 이싿
  - 불변 객체란 인스턴스화한 다음 객체의 상태를 바꿀 수 없는 객체를 말한다

### 선언형 프로그래밍
- 시스템을 구현하는 프로그래밍 방식은 명령형과 선언형 두 가지로 나눌 수 있다
- 명령형 프로그래밍 형식은 작업을 어떻게 수행할 것인지에 집중한다
  - A 작업을 하기 위해서는 어떻게 하고, A 작업이 종료된 후에는 B 작업을 수행한다...
- 선언형 프로그래밍 형식은 작업을 수행할 대상에 집중한다
  - 작업의 수행 방식은 라이브러리가 결정한다
  - 선언형 프로그래밍에서는 우리가 원하는 것이 무엇이고 시스템이 어떻게 그 목표를 달성할 것인지 등의 규칙을 정한다
  - 문제 자체가 코드로 명확하게 드러난다는 점이 선언형 프로그래밍의 강점이다

### 왜 함수형 프로그래밍인가?
- 함수형 프로그래밍은 선언형 프로그래밍을 따르는 대표적인 방식이다
  - 부작용 없는 계산을 지향한다
  - 자바의 람다처럼 작업을 조합하거나 동작을 전달할 수 있다
  - 자바의 스트림처럼 여러 연산을 연결해서 복잡한 질의를 표현할 수 있다

## 함수형 프로그래밍이란 무엇인가?
- 함수형 프로그래밍이란 함수를 이용하는 프로그래밍 방식이다
- 함수형 프로그래밍에서 함수란 수학에서의 함수와 같다
  - 함수형이란 말은 수학의 함수처럼 부작용 없는 것을 의미한다
- 0개 이상의 인수를 가지며, 한 개이상의 결과를 반환하지만 부작용이 없어야 한다
- 자바와 같은 언어에서는 수학적인 함수냐 아니냐가 메서드와 함수를 구분하는 핵심이다
  - 수학적인 함수는 반복 호출했을 때 항상 같은 결과가 반환된다
- 함수와 if-then-else 등의 수학적인 표현만 사용하는 방식을 순수 함수형 프로그래밍이라 한다
- 시스템의 다른 부분에 영향을 미치지 않느다면 내부적으로는 함수형이 아닌 기능도 사용하는 방식을 함수형 프로그래밍이라 한다

### 함수형 자바
- 실질적으로 자바로는 완벽한 순수 함수형 프로그래밍을 구현하기 어렵다
- 자바에서는 순수 함수형이 아니라 함수형 프로그램을 구현할 것이다
  - 실제로 부작용이 있지만 아무도 이를 보지 못하게 함으로써 함수형을 달성할 수 있다

- 함수나 메서드는 지역 변수만을 변경해야 함수형이라 할 수 있다
- 그리고 함수나 메서드에서 참조하는 객체가 있다면 그 객체는 불변 객체여야 한다
- 예외적으로 메서드 내에서 생성한 객체의 필드는 갱신할 수 있다
  - 단 새로 생성한 객체의 필드 갱신이 외부에 노출되지 않아야 하고, 다음에 메서드를 다시 호출한 결과에 영향을 미치지 않아야 한다
- 함수형이라면 함수나 메서드가 어떤 예외도 일으키지 않아야 한다
  - 예외가 발생하면 return 으로 결과를 반환할 수 없기 때문이다
  - 예외를 발생하지 않기 위해 Optional을 사용할 수 있다
  - 혹은 다른 컴포넌트에 영향을 미치지 않도록 지역적으로만 예외를 사용하는 방법도 있다
- 함수형에서는 비함수형 동작을 감출 수 있는 상황에서만 부작용을 포함하는 라이브러리 함수를 사용해야 한다
  - 자료구조를 복사 한다든가 발생할 수 있는 예제를 적절하게 내부적으로 처리하여 자료구조의 변경을 호출자가 알 수 없도록 감춰야 한다
  - 설명을 주석으로 표현하거나 마커 어노테이션으로 메서드를 정의할 수 있다

### 참조 투명성
- 부작용을 감춰야 한다는 제약은 참조 투명셩(referential transparency) 개념으로 귀결된다
  - 같은 인수로 함수를 호출했을 때 항상 같은 결과를 반환한다면 참조적으로 투명한 함수라고 표현한다
- 참조 투명성은 프로그램 이해에 큰 도움을 준다
- 참조 투명성은 비싸거나 오랜 시간이 걸리는 연산을 기억화 또는 캐싱을 통해 다시 계산하지 않고 저장하는 최적화 기능도 제공한다
- 자바에는 참조 투명성과 관련한 작은 문제가 있다
  - List를 반환하는 메서드를 두 번 호출한다고 가정한다.
  - 결과 리스트가 가변 객체라면 리스트를 반환하는 메서드는 참조적으로 투명하지 않다
  - 결과 리스트를 불변의 순수값으로 사용할 것이라면 두 리스트가 같은 객체라고 볼 수 있으므로 리스트 생성 함수는 참조적으로 투명한 것이라고 볼 수 있다
  - 함수형 코드에서는 이런 함수를 참조적으로 투명한 것으로 간주한다

### 객체지향 프로그래밍과 함수형 프로그래밍
- 익스트림 객체지향 방식은 모든 것을 객체로 간주하고 프로그램이 객체의 필드를 갱신하고, 메서드를 호출하고, 관련 객체를 갱신하는 방식으로 동작한다
- 함수형 프로그래밍 방식은 참조적 투명성을 중시해 변화를 허용하지 않는다

## 재귀와 반복
- 순수 함수형 프로그래밍에서는 while, for문 같은 반복문을 포함하지 않는다
  - 외부 반복자를 사용하면 자연스럽게 변화가 스며들 수 있기 떄문이다
- 함수형 프로그래밍의 장점이 분명히 있지만 무조건 반복보다는 재귀가 좋다고 주장하는 것은 옳지 않다
  - 일반적으로 반복보다 재귀의 비용이 더 크다
  - 재귀 호출 시 생성되는 정보를 저장할 새로운 스택 프레임이 만들어지기 떄문이다
  - 함수형 언어에서는 꼬리 재귀 최적화라는 해결책을 제공한다
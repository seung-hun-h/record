# 4계층 장비의 특징
---
4계층 장비는 TCP와 같은 4계층 헤더 정보를 이해하고 이를 기반으로 동작한다. 4계층 이상에 동작하는 로드 밸런서, 방화벽과 같은 장비를 세션 장비라고도 부른다.

세션 장비는 추가로 고려해야할 사항이 다음과 같다.

- 세션 테이블
  - 세션 장비는 세션 테이블을 기반으로 운영된다
  - 세션 정보를 저장, 확인하는 작업 전반에 대한 이해가 필요하다
  - 세션 정보는 세션 테이블에 남아있는 라이프 타임이 존재한다
   
- Symmetric 경로 요구
  - Inbound와 Outbound 경로가 일치해야한다   

- 정보 변경
  - IP 주소가 변경되며 확장된 L7 로드 밸런서(ADC)는 애플리케이션 프로토콜 정보도 변경된다.

# 로드 밸런서
---
서버나 장비 부하를 분산하기 위해 사용하는 장비를 로드밸런서라 부른다. 트래픽을 분산해주는 기능뿐 아니라 4계층 이상에서 동작하면서 IP 주소나 4계층 정보, 애플리케이션 정보를 확인 수정하는 기능이 있다.

로드 밸런서가 서비스에 사용되는 대표 IP 주소를 서비스 IP로 갖고 그 밑에 시스템이 늘어나면 로드 밸련서가 각 시스템의 실제 IP로 변경해 요청을 보낸다.

### L4 로드 밸런싱
일반적인 로드 밸런서가 동작하는 방식이다. TCP, UDP 정보를 기반으로 로드 밸런싱을 수행한다. 장비에서 L7 지원 여부와 상관없이 4계층에 대한 정보로만 분산 처리하는 경우를 L4 로드 밸런싱 이라한다.

### L7 로드 밸런싱
HTTP, FTP, SMTP와 같은 애플리케이션 프로토콜 정보를 기반으로 로드 밸런싱을 수행한다. HTTP 헤더 정보나 URI와 같은 정보를 기반으로 프로토콜을 이해한 후 부하르 분산할 수 있다. 일반적으로 ADC(Application Delivery Contoller)라 부르며 프록시 역할을 수행한다.

## L4 스위치와 ADC
L4 스위치는 4계층에서 동작하면서 로드 밸런서 기능이 있는 스위치를 말한다. L4 스위치는 부하 분산, 성능 최적화, 리다이렉션 기능을 수행한다.

ADC는 애플리케이션 계층에서 동작하는 로드 밸런서이다. L4 스위치와 달리 애플리케이션 프로토콜의 헤더와 내용을 이해하고 동작하므로 다양한 부하 분산, 정보 수정, 정보 필터링이 가능하다.

ADC는 이러한 상세한 기능을 제공하기 위해 프락시로 동작한다. 대부분의 ADC는 L4 스위치의 기능을 모두 제공한다. 대부분의 ADC는 4계층에서 애프리케이션 계층까지 로드 밸런싱 기능을 제공하고 페일오버(장애 극복), 리다이렉션, 캐싱, 압축, 인코딩 변환 등 애플리케이션을 이해하고 최적화하는 기능을 제공한다.

웹 서버에 콘텐츠 압축 기능이 있지만 ADC에서 이 역할을 수행해 서버의 부하를 줄일 수 있다. 그리고 ADC는 SSL의 엔드 포인트로 동작해 클라이언트에서 ADC까지의 구간을 SSL로 처리해주고 ADC와 웹 서버 사이를 일반 HTTP를 이용해 통신한다.



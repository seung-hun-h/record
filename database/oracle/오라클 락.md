# Locking Mechanism
## Use of Lock
- Lock은 데이터베이스의 **Concurrency**, **Consistency**, **Integrity**를 제공하는데 사용된다
	- Concurrency: 여러 사용자가 동시에 데이터베이스에 접근할 수 있다
	- Consistency: 한 세션에서 접근하고 있는 데이터는 다른 세션에서 변경되지 않는다
	- Integrity: 모든 변경사항들이 올바른 순서로 반영된다

<img width="700" alt="image" src="https://user-images.githubusercontent.com/60502370/233868403-b7c02ed9-1efb-4aae-bc09-488262224ad0.png">
<img width="700" alt="image" src="https://user-images.githubusercontent.com/60502370/233868408-0177b509-6b04-4b3c-abbe-b538e05c13b4.png">
<img width="700" alt="image" src="https://user-images.githubusercontent.com/60502370/233868417-aef9c628-7b3a-447e-94a9-830d2fe4dcbb.png">
<img width="700" alt="image" src="https://user-images.githubusercontent.com/60502370/233868424-9a04669b-6590-42bb-89a3-2d057c2580de.png">
<img width="700" alt="image" src="https://user-images.githubusercontent.com/60502370/233868436-838815b3-818a-4ef8-831a-85ecf08dee6c.png">

## Lock Modes
- 오라클 데이터베이스는 최소한의 제한(restrictveness)로 최대한의 데이터 동시성을 제공한다. 동시에 실패 안전(fail-safe)한 데이터 무결성을 제공한다

### Lock Modes
- Exclusive lock mode
	- 데이터가 공유되지 않도록 한다
	- 트랜잭션이 데이터를 변경하기 위해서는 배제 락(Exclusive lock)을 획득 해야 한다
- Shared lock mode
	- 데이터가 공유될 수 있도록 한다
	- 여러 사용자가 동시에 데이터를 공유할 수 있도록 한다
	- 공유 락(Shared lock)을 가지고 있으면, 다른 트랜잭션에서 배제 락을 획득하여 데이터를 변경하는 것을 막는다
- `SELECT ... FOR UPDATE` 구문이 실행되면 row에 대해서 배제 락을 획득하고 table에 대해서 공유 락을 획득한다
	- row가 다른 세션에 의해서 공유되는 것을 막고, table이 다른 세션에 의해서 변경되는 것을 막는다

## Lock conversion and escalation
- Lock Conversion
	- 자동으로 낮은 제한 수준의 락을 높은 제한 수준의 락으로 변경하는 것이다
	- Lock Conversion에서 사용자의 개입은 없다
	- `SELECT ... FOR UPDATE` 구문으로 먼저 데이터를 읽은 후 나중에 변경하게되면 오라클은 자동적으로 락을 변경한다
- Lock Escalation
	- 동일한 많은 수의 락이 공유될 때 자동으로 높은 제한 수준의 락으로 변경하는 것이다
	- 오라클은 Lock Escalation은 사용하지 않는다. 데드락이 발생할 확률을 높이기 때문이다

## Lock Duration
- 트랜잭션에서 해당 자원을 더 이상 사용하지 않을 때 락을 해제한다
- 일반적으로 오라클에서는 트랜잭션이 끝날 때 락을 해제한다


# NAT/PAT
---
NAT(Network Address Translation)은 이름 그대로 네트워크 주소를 변환하는 기술이다. NAT는 기본적으로 1:1 변환이지만 IP 주소가 고갈되는 문제를 해결하기 위해 N:1으로 변환하기도 한다. 여러 개의 IP를 하나의 IP로 변환하는 기술도 NAT의 기술 중 하나이지만 실제 공식 용어는 NAPT(Network Address Port Translation)이며 실무에서는 PAT라고 부른다.

NAT를 사용하면 사설 IP를 공인 IP로 변환할 수 있고 그 반대도 가능하다. 또한 사설 IP <-> 사설 IP, 공인 IP <-> 공인 IP변환도 물론 가능하다.

## NAT/PAT의 필요성
### IPv4의 주소 고갈
인터넷의 대중화로 폭증한 IP 주소의 요구를 극복하기 위해 단기, 중기, 장기 전략을 수립했다. 그 중 중기 전략이 NAT와 사설 IP 체계이다. NAT는 IPv4 주소 보존에 큰 기여를 했는데, 외부에 공개해야하는 서비스에 대해서는 공인 IP를 사용하고 외부에 공개할 필요가 없는 일반 사용자 PC나 기타 종단 장비에 대해서는 사설 IP를 꼭 필요한 곳에만 효율적으로 IP를 사용할 수 있게 되었다.

### 보안 강화
외부와 통신할 때 내부IP를 다른 IP로 변환하여 통신하면 외부에 사내 IP 체계를 숨길 수 있다. NAT를 사용하면 외부에서 들어오는 통신은 제한하고 내부에서 외부로 나가는 통신은 허용하여 보안을 강화할 수 있다.

### IP 주소 체계가 같은 두 개의 네트워크 통신을 가능하게 해준다

공인 IP는 인터넷상에서 유일해야 하지만, 사설 IP는 외부와 통신할 때 공인 IP로 변환되어 통신하므로 서로 다른 회사에서 중복해 사용할 수 있다.

### 불필요한 설정 변경을 줄일 수 있다.

공인 IP는 자신이 소유하는 것이 아니라 빌려서 사용하는 것이므로 회선 사업자를 바꾸거나 IDC를 이전하면 더이상 같은 IP를 사용할 수 없다. 하지만 NAT를 사용하여 내부 네트워크를 구성하고 있었다면 서버와 PC의 IP 주소 변경 없이 회선과 IDC 사업자 이전이 가능하다.

# DNS
도메인 주소를 IP 주소로 변환하는 역할을 한다. 

<p align=middle>
    <img src=https://user-images.githubusercontent.com/60502370/140957863-e6b6a522-ba2a-40bb-9995-626a5f29edd5.png width=500>
</p>

사용자가 웹 브라우저에 naver.com을 입력하면 DNS 서버에 naver.com의 IP 주소가 무엇인지 질의하고, DNS 서버는 naver.com의 IP 주소가 202.179.177.21이라고 사용자에게 알려준다. 사용자는 응답 받은 IP 주소로 실제 naver.com에 접속하게 된다.

## DNS 동작 방식
<p align=middle>
    <img src=https://user-images.githubusercontent.com/60502370/140958341-85eb8ef7-666a-49b7-865d-b1f3a6895404.png width=700>
</p>

1. 사용자 호스트는 'zigispace.net'이라는 도메인 주소의 IP 주소가 로컬 캐시에 있는 지 확인한다.
2. 'zigispace.net'이 로컬 캐시에 저장되어 있지 않으면 사용자 호스트에 설정된 DNS에 'zigispace.net'에 대해 쿼리한다
3. DNS 서버는 'zigispace.net'이 로컬 캐시와 자체에 설정되어 있는지 직접 확인하고 없으면 해당 도메인을 찾기 위해 루트 NS에 .net에 대한 TLD 정보를 가진 도메인 주소를 쿼리한다
4. 루트 DNS는 'zigispace.net'의 TLD(Top-Level Domain)인 '.net'을 관리하는 TLD 네임 서버 정보를 DNS 서버에 응답한다
5. DNS는 TLD 네임 서버에 'zigispace.net'에 대한 정보를 다시 쿼리한다
6. TLD 네임 서버는 'zigispace.net'에 대한 정보를 가진 zigi 네임 서버에 대한 정보를 DNS 서버로 응답한다
7. DNS는 zigi 네임 서버에 'zigispace.net'에 대한 정보를 쿼리한다
8. zigi 네임 서버는 'zigispace.net'에 대한 정보를 쿼리한다
9. DNS는 'zigispace.net'에 대한 정보를 로컬 캐시에 저장하고 사용자 호스트에 'zigi space.net'에 대한 정보를 응답한다
10. 사용자 호스트는 DNS로부터 받은 'zigispace.net'에 대한 IP 정보를 이용해 사이트에 접속한다.

## 마스터와 슬레이브
DNS 서버는 마스터 서버와 슬레이브 서버로 나눌 수 있다. 마스터 서버가 우선순위가 더 높지 않고 두 서버 모두 도메인 쿼리에 응답한다. 마스터와 슬레이브는 도메인에 대한 존(Zone) 파일을 직접 관리하는지 여부로 구분한다. 마스터 서버는 존 파일을 직접 생성해 도메인 관련 정보를 관리하고 슬레이브 서버는 마스터에 만들어진 존 파일을 복제한다. 이러한 과정을 영역 전송이라한다.

마스터 서버는 도메인 영역을 생성하고 레코드를 직접 관리하지만 슬레이브 서버는 마스터 서버에 설정된 도메인이 가진 레코드 값을 정기적으로 복제한다.

<p align=middle>
    <img src=https://user-images.githubusercontent.com/60502370/140959927-b5638717-38cb-4ba8-8edc-a18790463959.png width=700>
</p>

DNS서버는 마스터 서버에 문자가 발생하고 일정 시간이 지나면 슬레이브 서버도 도메인에 대한 질의에 정상적으로 응답할 수 없다. 이 시간을 만료 시간이라고한다. 만료 시간안에 슬레이브 서버가 마스터 서버에서 존 정보를 받아오지 못하면 슬레이브의 존 정보는 사용할 수 없다. 따라서 만료 시간 안에 마스터 서버를 복구하거나 슬레이브 서버를 마스터로 전환해야만 서비스 장애를 막을 수 있다.

# DHCP
---
네트워크 정보를 호스트에 적용하려면 사용자가 직접 IP 정보를 설정하거나 IP 정보를 할당해주는 서버를 이용해 자동으로 설정해야한다. 수동으로 할당하는 것을 정적할당 자동으로 할당하는 것을 동적할당이라 한다.

핸드폰이나 PC를 사용할 때 IP를 별도로 설정하지 않아도 네트워크에 쉽게 접속이 되므로 특별한 경우를 제외하고 동적 할당 방식을 기본으로 사용한다. 가정에서 사용하는 공유기도 동적 할당 방식을 기본으로 사용한다.

이렇게 IP를 동적으로 할당하는 데 사용되는 프로토콜이 DHCP(Dynamic Host Configuration Protocol)이다

DHCP를 사용하면 사용자가 직접 입력해야 하는 IP 주소, 서브넷 마스크, 게이트웨이, DNS 정보를 자동으로 할당 받아 사용할 수 있다. 편리하게 네트워크에 접속할 수 있고 사용하지 않는 IP 정보는 회수되어 필요한 경우에만 재할당되어 사용자 이동이 많고 한정된 IP 주소를 가진 경우 유용하게 사용할 수 있다.

## 동작 방식
<p align=middle>
    <img src=https://user-images.githubusercontent.com/60502370/140961278-c0289952-adc0-480b-a027-c9245a09c5ae.png width=700>
</p>

1. DHCP Discover

DHCP 클라이언트는 DHCP 서버를 찾기 위해 DHCP Discover 메시지를 작성해 브로드캐스트로 전송한다.

2. DHCP Offer

DHCP Discover를 수신한 DHCP 서버는 클라이언트에 할당할 IP 주소와 서브넷, 게이트웨이, DNS 정보, Lease Time 등의 정보를 포함한 DHCP 메시지를 클라이언트로 전달한다.

3. DHCP Request

DHCP 서버로부터 제안받은 IP 주소와 DHCP 서버 정보를 포함한 DHCP 요청 메시지를 브로드캐스트로 전달한다.

4. DHCP Acknowledgement

DHCP 클라이언트로부터 IP 주소를 사용하겠다는 요청을 받으면 DHCP 서버에 해당 IP를 어떤 클라이언트가 언제부터 사용하기 시작했는지 정보를 기록하고 DHCP Request 메시지를 정상적으로 수신했다는 응답을 전송한다.